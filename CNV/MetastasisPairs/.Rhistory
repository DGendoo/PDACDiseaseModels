ColTemplateDoubles1<-c("#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462")
ColorListDoubles1<-rep(ColTemplateDoubles1, each=3) #30 colors of 15 pairs
# Read all parameters file
CNVs<-sort(list.files(pattern = "parameters"))
CNVList<-lapply(CNVs,function(x){read.table(x,header=TRUE)})
CNVs<-sapply(CNVs,function(x) gsub(x,pattern = "parameters_", replacement = ""))
names(CNVList)<-CNVs
names(CNVList)<-gsub(x = names(CNVList),pattern = "_526",replacement = "" )
names(CNVList)<-gsub(x = names(CNVList),pattern = ".txt",replacement = "" )
names(CNVList)<-gsub(x = names(CNVList),pattern = "Lv_",replacement = "" )
# Compress all into one table
ParamsTable<-do.call(rbind.data.frame, CNVList)
write.csv(ParamsTable,"CNV_Params_LIVER.csv")
#Quick formatting for figures!
ParamsTable<-as.matrix(do.call(rbind.data.frame, c(CNVList[1:2],NA,CNVList[3:4],NA,CNVList[5:6],NA,
CNVList[7:8],NA,CNVList[9:10],NA,CNVList[11:12])))
ParamsTable<-data.frame(ParamsTable)
# Plot the Tumour & Normal component across the pairs
pdf("MergedInfo_LIVER_Pairs.pdf",height = 7)
par(mfrow=c(2,1))
barplot(ParamsTable$Ploidy,col = ColorListDoubles1,las=2,
names.arg = rownames(ParamsTable),ylab="Ploidy")
abline(a = 2,b = 0,col="red",lty=2)
barplot(ParamsTable$T1*100,col = ColorListDoubles1,las=2,
ylim = c(0,100),ylab = "% Tumour")
dev.off()
##################################################
library(pheatmap)
library(reshape2)
#Chromosomes!
chromosomes<-c("chr1","chr2","chr3","chr4","chr5","chr6","chr7","chr8","chr9","chr10","chr11","chr12",
"chr13","chr14","chr15","chr16","chr17","chr18","chr19","chr20","chr21","chr22","chrX","chrY")
CNVs<-sort(list.files(pattern = "_Final.bed"))
CNVListTemp<-lapply(CNVs,function(x){read.table(x,header=FALSE)})
CNVs<-sapply(CNVs,function(x) gsub(x,pattern = "segments_", replacement = ""))
names(CNVListTemp)<-CNVs
names(CNVListTemp)<-gsub(x = names(CNVListTemp),pattern = "_CN_Final.bed",replacement = "" )
###########################
# Params - read in ploidy etc from Celluloid
Params<-read.csv("CNV_Params_LIVER.csv")
colnames(Params)[1]<-"Sample"
rownames(Params)<-Params$Sample
Params$Ploidy
# Some cleanup
for(count in 1:length(CNVListTemp))
{
message("Processing Pair #: ",count)
colnames(CNVListTemp[[count]])<-c("TuChr","TuStart","TuEnd","TuSample","TuCN",
"PDXChr","PDXStart","PDXEnd","PDXSample","PDXCN","GenomicOverlap")
CNVListTemp[[count]]$TuSample<-paste(names(CNVListTemp)[[count]],"_M",sep="")
CNVListTemp[[count]]$PDXSample<-paste(names(CNVListTemp)[[count]],"_X",sep="")
for (tally in 1:nrow(CNVListTemp[[count]]))
{
ifelse((CNVListTemp[[count]]$GenomicOverlap[tally] == 0 & CNVListTemp[[count]]$TuCN[tally] == -1),
CNVListTemp[[count]]$TuCN[tally] <- NA,CNVListTemp[[count]]$TuCN[tally] <- CNVListTemp[[count]]$TuCN[tally])
ifelse((CNVListTemp[[count]]$GenomicOverlap[tally] == 0 & CNVListTemp[[count]]$PDXCN[tally] == -1),
CNVListTemp[[count]]$PDXCN[tally] <- NA,CNVListTemp[[count]]$PDXCN[tally] <- CNVListTemp[[count]]$PDXCN[tally])
}
for (rownum in 1:nrow(CNVListTemp[[count]]))
{
if(CNVListTemp[[count]]$GenomicOverlap[rownum] == 0)
{
if(is.na(CNVListTemp[[count]]$TuCN[rownum]))
{ CNVListTemp[[count]]$GenomicOverlap[rownum] <- (CNVListTemp[[count]]$PDXEnd[rownum]-CNVListTemp[[count]]$PDXStart[rownum])}
if(is.na(CNVListTemp[[count]]$PDXCN[rownum]))
{ CNVListTemp[[count]]$GenomicOverlap[rownum] <- (CNVListTemp[[count]]$TuEnd[rownum]-CNVListTemp[[count]]$TuStart[rownum])}
}
}
Ploidy_P<-Params[unique(CNVListTemp[[count]]$TuSample),]$Ploidy
Ploidy_X<-Params[unique(CNVListTemp[[count]]$PDXSample),]$Ploidy
CNVListTemp[[count]]$TuCN<-CNVListTemp[[count]]$TuCN/Ploidy_P
CNVListTemp[[count]]$PDXCN<-CNVListTemp[[count]]$PDXCN/Ploidy_X
CNVListTemp[[count]]$Jump<-abs(CNVListTemp[[count]]$TuCN - CNVListTemp[[count]]$PDXCN)
}
CNVList<-CNVListTemp
rm(CNVListTemp)
##################################################
# Now Calculate the Jaccard Index!!
#############################
##################################################
Jaccards<-NULL
for (count in 1:length(CNVList))
{
Sample<-CNVList[[count]] #Sample
Sample$PDXCN[is.na(Sample$PDXCN)]<-"MISS"
Sample$TuCN[is.na(Sample$TuCN)]<-"MISS"
TumourBasesWithCN<-sum(as.numeric(Sample$GenomicOverlap[Sample$TuCN!="MISS"]))
PDXBasesWithCN<-sum(as.numeric(Sample$GenomicOverlap[Sample$PDXCN!="MISS"]))
IntersectingBases<-sum(as.numeric(Sample$GenomicOverlap[which(Sample$Jump<= 0.25)]))
JaccardScore<-IntersectingBases/(TumourBasesWithCN + PDXBasesWithCN -IntersectingBases)
message("Jaccard Index: ",JaccardScore)
message("")
Jaccards[count]<-JaccardScore
}
Jaccards<-data.frame("Sample"=names(CNVList),"Jaccard"=Jaccards)
write.csv(Jaccards,file="CNV_Jaccard_LIVER.csv")
Jaccards
# Deena M.A. Gendoo
source('~/Desktop/Github_PDACDiseaseModels/CNV/MetastasisPairs/CopyNumberVariation_Metastasis_Pairs.R')
source('~/Desktop/Github_PDACDiseaseModels/CNV/MetastasisPairs/CalculateConcordance_Metastasis_Pairs.R')
